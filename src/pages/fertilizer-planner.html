<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2e463b">
    <title>Bemestingskalender - de Gazon App</title>

    <!-- Centrale CSS -->
    <link rel="stylesheet" href="../assets/css/main.css">

    <style>
        /* Order option cards */
        .order-option {
            padding: 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-fast);
            text-decoration: none;
            display: block;
        }
        .order-option.primary {
            background: rgba(137,184,101,0.15);
            border: 1px solid rgba(137,184,101,0.3);
        }
        .order-option.secondary {
            background: rgba(242,159,64,0.15);
            border: 1px solid rgba(242,159,64,0.3);
        }
        .order-option.tertiary {
            background: rgba(137,184,101,0.1);
            border: 1px solid rgba(137,184,101,0.2);
        }

        /* Product checkbox styling */
        .product-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: background var(--transition-fast);
        }
        .product-item:hover {
            background: rgba(255,255,255,0.08);
        }
        .product-item.selected {
            background: rgba(137,184,101,0.15);
            border-color: rgba(137,184,101,0.3);
        }

        /* Timeline item */
        .timeline-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: rgba(255,255,255,0.05);
            border-radius: var(--radius-md);
            border-left: 3px solid var(--color-accent);
        }

        /* Points toast */
        .points-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(137,184,101,0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 3rem;
            border-radius: var(--radius-lg);
            text-align: center;
            z-index: 2000;
            box-shadow: var(--shadow-lg);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="page-header">
        <h1>Bemestingskalender</h1>
        <p>Plan jouw gazonverzorging</p>
    </header>

    <!-- Content -->
    <main class="page-content">

        <!-- Order Options -->
        <section class="card">
            <h2 style="text-align: center; margin-bottom: 1rem;">Hoe wil je bestellen?</h2>

            <div style="display: flex; flex-direction: column; gap: 0.75rem;">
                <!-- Option 1: Have products -->
                <div id="option-have-products" class="order-option primary">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(137,184,101,0.2); display: flex; align-items: center; justify-content: center;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2">
                                <path d="M20 6L9 17l-5-5"></path>
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="font-size: 0.9rem; font-weight: 600; margin: 0 0 0.25rem;">Ik heb al producten</h3>
                            <p class="text-muted" style="font-size: 0.75rem; margin: 0;">Selecteer hieronder welke producten je al hebt</p>
                        </div>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"></polyline>
                        </svg>
                    </div>
                </div>

                <!-- Option 2: Standard package -->
                <a href="https://graszoden.expert/" target="_blank" class="order-option secondary">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(242,159,64,0.2); display: flex; align-items: center; justify-content: center;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-orange)" stroke-width="2">
                                <circle cx="9" cy="21" r="1"></circle>
                                <circle cx="20" cy="21" r="1"></circle>
                                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="font-size: 0.9rem; font-weight: 600; margin: 0 0 0.25rem;">Standaard pakket bestellen</h3>
                            <p class="text-muted" style="font-size: 0.75rem; margin: 0;">Bestel een kant-en-klaar pakket in onze webshop</p>
                        </div>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                    </div>
                </a>

                <!-- Option 3: Custom package -->
                <a href="https://www.graszoden.expert/gazon-analyse/" target="_blank" class="order-option tertiary">
                    <div style="display: flex; align-items: center; gap: 0.75rem;">
                        <div style="width: 40px; height: 40px; border-radius: 50%; background: rgba(137,184,101,0.15); display: flex; align-items: center; justify-content: center;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-accent)" stroke-width="2">
                                <circle cx="11" cy="11" r="8"></circle>
                                <path d="m21 21-4.35-4.35"></path>
                            </svg>
                        </div>
                        <div style="flex: 1;">
                            <h3 style="font-size: 0.9rem; font-weight: 600; margin: 0 0 0.25rem;">Pakket op maat</h3>
                            <p class="text-muted" style="font-size: 0.75rem; margin: 0;">Beantwoord een paar vragen en krijg direct het juiste pakket</p>
                        </div>
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="rgba(255,255,255,0.5)" stroke-width="2">
                            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                            <polyline points="15 3 21 3 21 9"></polyline>
                            <line x1="10" y1="14" x2="21" y2="3"></line>
                        </svg>
                    </div>
                </a>
            </div>
        </section>

        <!-- Product Selection -->
        <section id="product-selection-section" class="card">
            <h2 class="card-title">Welke producten heb je?</h2>
            <div id="products-container" style="display: flex; flex-direction: column; gap: 0.75rem;">
                <!-- Products rendered by JavaScript -->
            </div>
        </section>

        <!-- Start Date -->
        <section class="card">
            <h2 class="card-title">Wanneer start je?</h2>
            <div class="form-group">
                <label class="form-label">Pakket ontvangen op:</label>
                <input type="date" id="start-date" class="form-input">
                <p class="text-muted" style="font-size: 0.75rem; margin-top: 0.5rem;">We berekenen het ideale schema vanaf deze datum</p>
            </div>
        </section>

        <!-- Schema Preview -->
        <section id="schema-section" class="card hidden">
            <h2 class="card-title">Jouw Persoonlijke Schema</h2>
            <div id="schema-timeline" style="display: flex; flex-direction: column; gap: 0.75rem;">
                <!-- Timeline rendered by JavaScript -->
            </div>
        </section>

        <!-- Action Buttons -->
        <section style="display: flex; flex-direction: column; gap: 0.75rem;">
            <button id="generate-btn" class="btn btn-primary">Genereer Schema</button>

            <div id="export-section" class="hidden" style="display: flex; flex-direction: column; gap: 0.75rem; align-items: center;">
                <button id="export-btn" class="btn btn-orange">Exporteer naar Kalender</button>
                <a href="#" id="edit-schema-link" class="text-muted" style="font-size: 0.875rem; text-decoration: underline;">Schema aanpassen</a>
            </div>
        </section>

        <!-- Points Toast -->
        <div id="points-toast" class="points-toast hidden">
            <p id="points-text" style="font-size: 1.25rem; font-weight: 700; margin: 0;">+50 GazonPunten!</p>
        </div>

    </main>    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <a href="#" onclick="event.preventDefault(); window.router.navigate('home')" class="nav-item">
            <div class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                    <polyline points="9 22 9 12 15 12 15 22"/>
                </svg>
            </div>
            <span class="nav-label">Home</span>
        </a>
        <a href="#" onclick="event.preventDefault(); window.router.navigate('fertilizer-planner')" class="nav-item active">
            <div class="nav-icon">
                <div class="calendar-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                        <line x1="16" y1="2" x2="16" y2="6"/>
                        <line x1="8" y1="2" x2="8" y2="6"/>
                        <line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span class="calendar-day"></span>
                </div>
            </div>
            <span class="nav-label">Kalender</span>
        </a>
        <a href="#" onclick="event.preventDefault(); window.router.navigate('loyalty')" class="nav-item">
            <div class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/>
                </svg>
            </div>
            <span class="nav-label">Punten</span>
        </a>
        <a href="#" onclick="event.preventDefault(); window.router.navigate('challenge')" class="nav-item">
            <div class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/>
                    <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/>
                    <path d="M4 22h16"/>
                    <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/>
                    <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/>
                    <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/>
                </svg>
            </div>
            <span class="nav-label">Challenge</span>
        </a>
        <a href="#" onclick="event.preventDefault(); window.router.navigate('settings')" class="nav-item">
            <div class="nav-icon">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
            </div>
            <span class="nav-label">Settings</span>
        </a>
    </nav>

    <!-- Centrale JS -->
    <script src="../assets/js/main.js"></script>

    <!-- Pagina-specifieke JS -->
    <script>
        // Product data
        const products = [
            { id: 'spring', name: 'Voorjaarsmest', timing: 'maart-april', days: 0 },
            { id: 'summer', name: 'Zomermest', timing: 'juni-juli', days: 90 },
            { id: 'fall', name: 'Herfstmest', timing: 'september-oktober', days: 180 },
            { id: 'seed', name: 'Graszaad (herstelzaai)', timing: 'voorjaar/najaar', days: 30 }
        ];

        let selectedProducts = [];
        let generatedSchema = [];
        let hasExported = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderProducts();
            setupEventListeners();

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('start-date').value = today;
        });

        function renderProducts() {
            const container = document.getElementById('products-container');
            container.innerHTML = products.map(product =>
                '<div class="product-item" data-id="' + product.id + '">' +
                    '<input type="checkbox" id="product-' + product.id + '" style="width: 20px; height: 20px; cursor: pointer;">' +
                    '<div style="flex: 1;">' +
                        '<div style="font-weight: 600;">' + product.name + '</div>' +
                        '<div class="text-muted" style="font-size: 0.75rem;">' + product.timing + '</div>' +
                    '</div>' +
                '</div>'
            ).join('');

            // Add click handlers
            document.querySelectorAll('.product-item').forEach(item => {
                item.addEventListener('click', function(e) {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = this.querySelector('input');
                        checkbox.checked = !checkbox.checked;
                    }
                    toggleProduct(this.dataset.id, this.querySelector('input').checked);
                });
            });
        }

        function toggleProduct(productId, selected) {
            const item = document.querySelector('.product-item[data-id="' + productId + '"]');
            if (selected) {
                selectedProducts.push(productId);
                item.classList.add('selected');
            } else {
                selectedProducts = selectedProducts.filter(id => id !== productId);
                item.classList.remove('selected');
            }
        }

        function setupEventListeners() {
            document.getElementById('generate-btn').addEventListener('click', generateSchema);
            document.getElementById('export-btn').addEventListener('click', exportToCalendar);
            document.getElementById('edit-schema-link').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('schema-section').classList.add('hidden');
                document.getElementById('export-section').classList.add('hidden');
                document.getElementById('generate-btn').classList.remove('hidden');
            });
        }

        function generateSchema() {
            if (selectedProducts.length === 0) {
                GazonApp.showToast('Selecteer minimaal 1 product', 'error');
                return;
            }

            const startDate = new Date(document.getElementById('start-date').value);
            if (!startDate || isNaN(startDate.getTime())) {
                GazonApp.showToast('Selecteer een startdatum', 'error');
                return;
            }

            // Generate schema
            generatedSchema = selectedProducts.map(productId => {
                const product = products.find(p => p.id === productId);
                const taskDate = GazonApp.addDays(startDate, product.days);
                return {
                    product: product.name,
                    date: taskDate,
                    dateStr: GazonApp.formatDate(taskDate)
                };
            }).sort((a, b) => a.date - b.date);

            renderSchema();

            // Show schema and export button
            document.getElementById('schema-section').classList.remove('hidden');
            document.getElementById('generate-btn').classList.add('hidden');
            document.getElementById('export-section').classList.remove('hidden');

            GazonApp.showToast('Schema gegenereerd!', 'success');
        }

        function renderSchema() {
            const container = document.getElementById('schema-timeline');
            container.innerHTML = generatedSchema.map((item, index) =>
                '<div class="timeline-item">' +
                    '<div style="display: flex; flex-direction: column; align-items: center; min-width: 60px;">' +
                        '<div style="font-size: 1.25rem; font-weight: 700;">' + item.date.getDate() + '</div>' +
                        '<div class="text-muted" style="font-size: 0.75rem;">' + item.date.toLocaleDateString('nl-NL', { month: 'short' }) + '</div>' +
                    '</div>' +
                    '<div style="flex: 1;">' +
                        '<div style="font-weight: 600; margin-bottom: 0.25rem;">' + item.product + '</div>' +
                        '<div class="text-muted" style="font-size: 0.75rem;">' + item.dateStr + '</div>' +
                    '</div>' +
                '</div>'
            ).join('');
        }

        function exportToCalendar() {
            if (!hasExported) {
                // Award points for first export
                GazonApp.addPoints(50, 'Schema geëxporteerd');
                hasExported = true;

                // Show custom toast
                const toast = document.getElementById('points-toast');
                toast.classList.remove('hidden');
                setTimeout(() => {
                    toast.classList.add('hidden');
                }, 2000);
            }

            // Create ICS file
            let icsContent = 'BEGIN:VCALENDAR\nVERSION:2.0\nPRODID:-//de Gazon App//NL\nCALSCALE:GREGORIAN\n';

            generatedSchema.forEach(item => {
                const dateStr = item.date.toISOString().split('T')[0].replace(/-/g, '');
                icsContent += 'BEGIN:VEVENT\n';
                icsContent += 'DTSTART;VALUE=DATE:' + dateStr + '\n';
                icsContent += 'SUMMARY:' + item.product + '\n';
                icsContent += 'DESCRIPTION:Gazonverzorging: ' + item.product + '\n';
                icsContent += 'END:VEVENT\n';
            });

            icsContent += 'END:VCALENDAR';

            // Download ICS file
            const blob = new Blob([icsContent], { type: 'text/calendar' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'gazon-schema.ics';
            link.click();
            URL.revokeObjectURL(url);

            GazonApp.showToast('Schema geëxporteerd naar kalender!', 'success');
        }
    </script>
</body>
</html>
